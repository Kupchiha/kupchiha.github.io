function sumBooking(){var t=0;$(".pb input:checked").each((function(){t+=parseInt($(this).attr("cena"))*parseInt($("#"+$(this).attr("room")).val())}));var e=new Date($("#datepicker3").val().replace(/(\d+).(\d+).(\d+)/,"$3/$2/$1")),a=new Date($("#datepicker4").val().replace(/(\d+).(\d+).(\d+)/,"$3/$2/$1")),n=Math.floor((a.getTime()-e.getTime())/864e5);$("#itogo").attr("rel",n),1==n&&($("#days").text(n+" сутки"),$("#days2").text(n+" сутки")),n>1&&($("#days").text(n+" суток"),$("#days2").text(n+" суток")),$("#itogo").text(t),$("#itogo2").text(t)}function activeFormBooking(){return $("#block_booking").fadeOut(50),$("#form_booking :input").attr("disabled",!1),$("#form_booking").css("opacity","1.0"),!1}function activateDays(t,e){sumBooking(),$("#itogo").text("0"),$("#itogo2").text("0"),$.post("widgets/booking/date.php",{date:t,date2:e},(function(t){if(t.length>0){if("1"==t)return alert("На выбранные Вами даты, забронировать номер online невозможно! Свяжитесь с отделом бронирования и мы подберем для Вас оптимальный вариант."),$("input[name=date_vyezda2]").val(""),$("#go").click(),!1;$(".tableBooking").html("Загрузка цен..."),$.post("widgets/booking/table.php",{data:t},(function(t){t.length>0&&$(".tableBooking").html(t)}))}return!1}))}jQuery.fn.center=function(){return this.css("position","absolute"),this.css("top",($(window).height()-80-this.outerHeight()-80)/2+$(window).scrollTop()-80+"px"),this.css("left",($(window).width()-this.outerWidth())/2+$(window).scrollLeft()+"px"),this},$(document).ready((function(){$("#block_booking").fadeOut(),$("a.commentRoom").click((function(){return $("div#inf"+$(this).attr("id")).fadeToggle(300),!1})),$(".pb input:radio").click((function(){sumBooking()})),$("a.clearChek").click((function(){return $("input[name='"+$(this).attr("name")+"']").attr("checked",!1),sumBooking(),!1})),$("#editBooking").click((function(){activeFormBooking()})),$("#form_booking input:submit").click((function(){$("#block_booking").center()})),$("#sendOkBooking").click((function(){var t=new Array;return $(".pb input:checked").each((function(){t.push($(this).val())})),$.post("widgets/booking/booking.php",{data:$("#rez_booking").html(),flag:1,email:$("input[name=email]").val(),comment:$("textarea[name=comment]").val()},(function(t){"1"==t?($("#form_booking").trigger("reset"),$("#rez_booking").html("<h1>Заявка отправлена!</h1><strong>В ближайшее время с Вами свяжется наш администратор, чтобы подтвердить бронирование.</strong>")):$("#rez_booking").html("<h1>Не удалось отправить заявку!</h1><strong>Повторите попытку или воспользуйтесь другими способами бронирования.</strong>"),$("#editBooking").attr("value","Закрыть"),$("#sendOkBooking").css("display","none")})),!1})),$("#datepicker3").is(":visible")&&($("#datepicker3").datepicker({firstDay:1,minDate:0,dateFormat:"dd.mm.yy",changeYear:"true",changeMonth:"true",dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],yearRange:"-0nn:+1nn",showButtonPanel:!0}),$("#datepicker4").datepicker({firstDay:1,minDate:1,dateFormat:"dd.mm.yy",changeYear:"true",changeMonth:"true",dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],yearRange:"-0nn:+1nn",showButtonPanel:!0})),$("#datepicker3").change((function(){var t=new Date,e=new Date($("#datepicker3").datepicker("getDate")),a=Math.floor((e.getTime()-t.getTime())/864e5+1);$("#datepicker4").datepicker("destroy"),$("#datepicker4").datepicker({minDate:a+1,dateFormat:"dd.mm.yy",changeYear:"true",changeMonth:"true",dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],yearRange:"-0nn:+1nn",showButtonPanel:!0}),10==$("input[name=date_zaezda2]").val().length&&10==$("input[name=date_vyezda2]").val().length&&activateDays($(this).val(),$("input[name=date_vyezda2]").val())})),$("#datepicker4").change((function(){10==$("input[name=date_zaezda2]").val().length&&10==$("input[name=date_vyezda2]").val().length&&activateDays($("input[name=date_zaezda2]").val(),$(this).val())})),$("form[name=form_booking]").submit((function(){var t=0;new Date($("#datepicker3").val().replace(/(\d+).(\d+).(\d+)/,"$3/$2/$1"))>new Date($("#datepicker4").val().replace(/(\d+).(\d+).(\d+)/,"$3/$2/$1"))&&(t=1,$("input[name=date_zaezda2]").val(""),$("input[name=date_vyezda2]").val(""),alert("Ошибка - дата выезда, больше даты заезда!")),$("form[name=form_booking] input[type=text]").each((function(){$(this).css("background-color","#e9eaeb")})),$("form[name=form_booking] input[type=text]").each((function(){$(this).val().length||"1"!=$(this).attr("rel")||($(this).css("background-color","#c06768"),t=1)}));var e=0;if($(".pb input:checked").each((function(){e+=1})),0==e)return alert("Не выбран номер для бронирования!"),!1;if(1==t)return alert("Одно из обязательных полей формы бронирования, не заполнено!"),!1;var a=new Array;$(".pb input:checked").each((function(){a.push($(this).val()+", Кол-во номеров: "+$("#"+$(this).attr("room")).val())}));var n=$("form[name=form_booking]").serialize();return $.post("widgets/booking/booking.php",{data:n,selectRooms:a,itogo:$("#itogo").text(),flag:0},(function(t){$("#editBooking").attr("value","Изменить бронь"),$("#sendOkBooking").css("display","block"),$("#rez_booking").html(t),$("#form_booking :input").attr("disabled",!0),$("#form_booking").css("opacity","0.2"),$("#block_booking").fadeIn(100)})),!1}))}));